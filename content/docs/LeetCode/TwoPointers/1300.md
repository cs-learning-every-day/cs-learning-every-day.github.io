```c++
class Solution {
public:
    int findBestValue(vector<int>& arr, int target) {
        // 所有数的sum<=target的话就返回最大的值
        // 二分找出 满足 sum >= target 的value
        std::sort(arr.begin(), arr.end());
        if (std::accumulate(arr.begin(), arr.end(), 0) <= target) 
            return arr.back();

        int lo = 0, hi = 1e8;
        // 找到 sum >= target的 value
        while (lo < hi) {
            int mid = (lo + hi) >> 1;
            if (sum(arr, mid) >= target) {
                hi = mid;
            } else {
                lo = mid + 1;
            }
        }
        
        int a = sum(arr, lo);
        int b = sum(arr, lo - 1);
        if (abs(a - target) < abs(b - target)) {
            return lo;
        } else {
            return lo - 1;
        }
    }
    // sum可以用前缀合优化
    int sum(vector<int>& arr, int x) {
        int sum = 0;
        for (int a : arr) {
            if (a >= x) {
                sum += x;
            } else {
                sum += a;
            }
        }
        return sum;
    }
};
```